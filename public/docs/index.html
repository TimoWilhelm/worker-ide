<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Worker IDE — Architecture</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			*,
			*::before,
			*::after {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			:root {
				/* Dark theme matching the app */
				--bg: #121212;
				--bg-surface: #191817;
				--bg-card: #2a2927;
				--border: #f0e3de20;
				--border-solid: #302c2a;
				--border-bright: #f0e3de40;
				--text: #f0e3de;
				--text-muted: #d4c8c2;
				--text-dim: #8a7f7a;
				--accent: #f14602;
				--accent-hover: #ff6d33;

				/* Lane colors - high contrast, distinct hues */
				--asset: #5cc8ff;
				--asset-dim: rgba(92, 200, 255, 0.12);
				--worker: #c490ff;
				--worker-dim: rgba(196, 144, 255, 0.12);
				--ws: #7dff6a;
				--ws-dim: rgba(125, 255, 106, 0.12);
				--cyan: #5cc8ff;
				--cyan-dim: rgba(92, 200, 255, 0.12);
				--emerald: #50e8a0;
				--emerald-dim: rgba(80, 232, 160, 0.12);

				/* Component colors - warm palette */
				--orange: #ff8c5a;
				--magenta: #ff70d0;
				--yellow: #ffd060;
				--red: #ff7070;
			}

			html {
				scroll-behavior: smooth;
			}

			body {
				font-family:
					'Space Grotesk',
					system-ui,
					-apple-system,
					sans-serif;
				background: var(--bg);
				color: var(--text);
				line-height: 1.6;
				overflow-x: hidden;
				min-height: 100vh;
			}

			body::before {
				content: '';
				position: fixed;
				inset: 0;
				background-image: radial-gradient(circle at 1px 1px, rgba(255, 255, 255, 0.02) 1px, transparent 0);
				background-size: 32px 32px;
				pointer-events: none;
				z-index: 0;
			}

			.page {
				position: relative;
				z-index: 1;
			}
			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 32px;
			}

			nav {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				z-index: 100;
				background: rgba(18, 18, 18, 0.85);
				backdrop-filter: blur(16px) saturate(1.5);
				border-bottom: 1px solid var(--border);
			}
			nav .container {
				display: flex;
				align-items: center;
				justify-content: space-between;
				height: 56px;
			}
			.logo {
				font-family: 'Space Mono', monospace;
				font-weight: 600;
				font-size: 15px;
				color: var(--accent);
				text-decoration: none;
				letter-spacing: 0.02em;
			}
			.nav-links {
				display: flex;
				gap: 24px;
			}
			.nav-links a {
				font-size: 14px;
				color: var(--text-muted);
				text-decoration: none;
				font-weight: 500;
				transition: color 0.2s;
			}
			.nav-links a:hover {
				color: var(--text);
			}

			.hero {
				padding: 120px 0 48px;
				text-align: center;
			}
			.hero h1 {
				font-size: clamp(32px, 4.5vw, 56px);
				font-weight: 800;
				letter-spacing: -0.04em;
				line-height: 1.1;
				margin-bottom: 16px;
			}
			.hero h1 .grad {
				background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 50%, var(--yellow) 100%);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
			}
			.hero p {
				color: var(--text-muted);
				font-size: 17px;
				max-width: 620px;
				margin: 0 auto 36px;
				line-height: 1.7;
			}

			.legend {
				display: flex;
				justify-content: center;
				gap: 20px;
				flex-wrap: wrap;
				margin-bottom: 8px;
			}
			.legend-item {
				display: flex;
				align-items: center;
				gap: 8px;
				font-family: 'Space Mono', monospace;
				font-size: 13px;
				font-weight: 500;
				letter-spacing: 0.04em;
				padding: 6px 16px;
				border-radius: 100px;
			}
			.legend-item .dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
			}
			.legend-item.asset {
				color: var(--asset);
				background: var(--asset-dim);
				border: 1px solid rgba(77, 184, 255, 0.2);
			}
			.legend-item.asset .dot {
				background: var(--asset);
			}
			.legend-item.worker {
				color: var(--worker);
				background: var(--worker-dim);
				border: 1px solid rgba(184, 102, 255, 0.2);
			}
			.legend-item.worker .dot {
				background: var(--worker);
			}
			.legend-item.ws {
				color: var(--ws);
				background: var(--ws-dim);
				border: 1px solid rgba(94, 255, 58, 0.2);
			}
			.legend-item.ws .dot {
				background: var(--ws);
			}

			.diagram-section {
				padding: 0 0 80px;
			}

			/* ── Lane container ── */
			.lane {
				background: rgba(25, 24, 23, 0.6);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 24px 28px 28px;
				margin-bottom: 24px;
				position: relative;
			}
			.lane-header {
				display: flex;
				align-items: center;
				gap: 12px;
				margin-bottom: 28px;
				padding-bottom: 16px;
				border-bottom: 1px solid var(--border);
			}
			.lane-dot {
				width: 10px;
				height: 10px;
				border-radius: 50%;
				flex-shrink: 0;
			}
			.lane-title {
				font-family: 'Space Mono', monospace;
				font-size: 16px;
				font-weight: 600;
				letter-spacing: 0.02em;
			}
			.lane-desc {
				font-size: 14px;
				color: var(--text-muted);
				margin-left: auto;
				font-family: 'Space Grotesk', sans-serif;
			}

			/* ── Flow label above a grid ── */
			.flow-label {
				font-family: 'Space Mono', monospace;
				font-size: 13px;
				font-weight: 600;
				letter-spacing: 0.08em;
				text-transform: uppercase;
				margin: 24px 0 14px;
				padding-left: 2px;
			}
			.flow-label:first-child {
				margin-top: 0;
			}

			/* ── Grid flow layout ── */
			.flow-grid {
				display: grid;
				grid-template-columns: 1fr minmax(60px, auto) 1fr minmax(60px, auto) 1fr;
				align-items: center;
				gap: 0;
				padding: 4px 0;
			}

			/* Column utilities for serpentine layout */
			.col-1 {
				grid-column: 1;
			}
			.col-2 {
				grid-column: 2;
			}
			.col-3 {
				grid-column: 3;
			}
			.col-4 {
				grid-column: 4;
			}
			.col-5 {
				grid-column: 5;
			}

			/* ── Node card ── */
			.node {
				background: rgba(18, 18, 18, 0.7);
				border: 1px dashed var(--node-color, var(--border-bright));
				border-radius: 3px;
				padding: 8px 6px;
				text-align: center;
				position: relative;
				min-width: 0;
				z-index: 1;
			}
			.node::before {
				content: '';
				position: absolute;
				inset: -3px;
				pointer-events: none;
				background:
					linear-gradient(var(--node-color, var(--border-bright)), var(--node-color, var(--border-bright))) 0 0 / 5px 5px no-repeat,
					linear-gradient(var(--node-color, var(--border-bright)), var(--node-color, var(--border-bright))) 100% 0 / 5px 5px no-repeat,
					linear-gradient(var(--node-color, var(--border-bright)), var(--node-color, var(--border-bright))) 0 100% / 5px 5px no-repeat,
					linear-gradient(var(--node-color, var(--border-bright)), var(--node-color, var(--border-bright))) 100% 100% / 5px 5px no-repeat;
				opacity: 0.4;
			}
			.node-name {
				font-family: 'Space Mono', monospace;
				font-size: 12px;
				font-weight: 600;
				color: var(--node-color, var(--text));
				line-height: 1.3;
				margin-bottom: 2px;
				white-space: nowrap;
			}
			.node-detail {
				font-family: 'Space Grotesk', sans-serif;
				font-size: 11px;
				color: var(--text-muted);
				line-height: 1.3;
				white-space: nowrap;
			}

			/* ── Horizontal arrow (sits between two node columns) ── */
			.h-arrow {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				padding: 0 2px;
				position: relative;
				min-width: 48px;
			}
			.h-arrow-label {
				font-family: 'Space Mono', monospace;
				font-size: 8px;
				font-weight: 500;
				color: var(--arrow-color, var(--text-muted));
				white-space: nowrap;
				opacity: 0.85;
				margin-bottom: 4px;
			}
			.h-arrow-line {
				width: 100%;
				height: 0;
				border-top: 1px dashed var(--arrow-color, var(--text-dim));
				position: relative;
			}
			/* Default: Right pointing arrow */
			.h-arrow-line::after {
				content: '';
				position: absolute;
				right: -1px;
				top: -4px;
				border-left: 6px solid var(--arrow-color, var(--text-dim));
				border-top: 4px solid transparent;
				border-bottom: 4px solid transparent;
			}
			/* Reverse: Left pointing arrow */
			.h-arrow.reverse .h-arrow-line::after {
				right: auto;
				left: -1px;
				border-left: none;
				border-right: 6px solid var(--arrow-color, var(--text-dim));
			}

			/* ── Vertical connector between grid rows ── */
			.v-connector {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 12px;
				padding: 0;
				min-height: 32px;
				grid-column: 1 / -1; /* Default span, override with .col-N */
			}
			.v-connector.right {
				flex-direction: row-reverse;
			}
			.v-connector-line {
				width: 0;
				height: 32px;
				border-left: 1px dashed var(--arrow-color, var(--text-dim));
				position: relative;
			}
			.v-connector-line::after {
				content: '';
				position: absolute;
				bottom: -1px;
				left: -4px;
				border-top: 6px solid var(--arrow-color, var(--text-dim));
				border-left: 4px solid transparent;
				border-right: 4px solid transparent;
			}
			.v-connector-label {
				font-family: 'Space Mono', monospace;
				font-size: 9px;
				font-weight: 500;
				color: var(--arrow-color, var(--text-muted));
				opacity: 0.85;
				white-space: nowrap;
			}

			/* ── Connector note between flow grids ── */
			.flow-connector {
				display: flex;
				align-items: center;
				gap: 10px;
				margin: 12px 0 4px 2px;
			}
			.flow-connector-icon {
				color: var(--text-dim);
				font-size: 18px;
				line-height: 1;
			}
			.flow-connector-text {
				font-family: 'Space Grotesk', sans-serif;
				font-size: 14px;
				color: var(--text-muted);
			}

			/* ── Lane footnote ── */
			.lane-note {
				font-family: 'Space Grotesk', sans-serif;
				font-size: 14px;
				color: var(--text-muted);
				margin-top: 20px;
				line-height: 1.5;
			}
			.lane-note code {
				font-family: 'Space Mono', monospace;
				background: var(--bg-card);
				padding: 2px 6px;
				border-radius: 3px;
				font-size: 13px;
			}

			/* Column utilities for serpentine layout (must be last to override) */
			.col-1 {
				grid-column: 1 !important;
			}
			.col-2 {
				grid-column: 2 !important;
			}
			.col-3 {
				grid-column: 3 !important;
			}
			.col-4 {
				grid-column: 4 !important;
			}
			.col-5 {
				grid-column: 5 !important;
			}

			.col-span-3 {
				grid-column: 2 / span 3 !important;
			}

			footer {
				padding: 48px 0;
				border-top: 1px solid var(--border);
				text-align: center;
			}
			footer p {
				color: var(--text-dim);
				font-size: 14px;
			}
			footer a {
				color: var(--text-muted);
				text-decoration: none;
			}
			footer a:hover {
				color: var(--text);
			}

			@media (max-width: 768px) {
				.hero {
					padding: 100px 0 24px;
				}
				.lane {
					padding: 16px 12px 16px;
					border-radius: 10px;
				}
				.container {
					padding: 0 12px;
				}
				.lane-desc {
					display: none;
				}
				.flow-grid {
					grid-template-columns: 1fr minmax(40px, auto) 1fr minmax(40px, auto) 1fr;
				}
				.node {
					padding: 6px 8px;
				}
				.node-name {
					font-size: 10px;
				}
				.node-detail {
					font-size: 9px;
				}
				.h-arrow {
					min-width: 32px;
				}
				.h-arrow-label {
					font-size: 8px;
				}
			}
		</style>
	</head>
	<body>
		<div class="page">
			<nav>
				<div class="container">
					<a href="/" class="logo">worker-ide</a>
					<div class="nav-links">
						<a href="https://github.com/TimoWilhelm/worker-ide" target="_blank">GitHub</a>
					</div>
				</div>
			</nav>

			<section class="hero">
				<div class="container">
					<h1>How <span class="grad">Worker IDE</span> works</h1>
					<p>
						A browser-based development environment running entirely on Cloudflare's edge — Durable Objects for storage, esbuild-wasm for
						transforms, and dynamic V8 isolates for user code.
					</p>
					<div class="legend">
						<span class="legend-item asset"><span class="dot"></span>Asset Pipeline + HMR</span>
						<span class="legend-item worker"><span class="dot"></span>Worker Execution</span>
						<span class="legend-item ws"><span class="dot"></span>WebSocket Feedback</span>
						<span class="legend-item" style="color: var(--cyan); background: var(--cyan-dim); border: 1px solid rgba(77, 184, 255, 0.2)"
							><span class="dot" style="background: var(--cyan)"></span>Dependency Resolution</span
						>
						<span
							class="legend-item"
							style="color: var(--emerald); background: var(--emerald-dim); border: 1px solid rgba(94, 255, 58, 0.2)"
							><span class="dot" style="background: var(--emerald)"></span>Git Integration</span
						>
					</div>
				</div>
			</section>

			<section class="diagram-section">
				<div class="container">
					<!-- LANE 1: ASSET PIPELINE + HMR -->
					<div class="lane">
						<div class="lane-header">
							<span class="lane-dot" style="background: var(--asset)"></span>
							<span class="lane-title" style="color: var(--asset)">Asset Pipeline + HMR</span>
							<span class="lane-desc">Save triggers HMR, then Preview fetches assets on-demand through esbuild</span>
						</div>

						<div class="flow-label" style="color: var(--asset)">Save + HMR Path</div>
						<div class="flow-grid">
							<!-- Row 1: Editor writes to Host, Host writes to DO -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Editor UI</div>
								<div class="node-detail">edit &amp; save</div>
							</div>
							<div class="h-arrow col-2" style="--arrow-color: var(--asset)">
								<span class="h-arrow-label">PUT /api/file</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--orange)">
								<div class="node-name">Host Worker</div>
								<div class="node-detail">handleAPI()</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--magenta)">
								<span class="h-arrow-label">fs.writeFile()</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--magenta)">
								<div class="node-name">DO Filesystem</div>
								<div class="node-detail">Durable Object</div>
							</div>

							<!-- Connector: Host Worker triggers HMR -->
							<div class="v-connector col-3" style="--arrow-color: var(--asset)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">triggers HMR</span>
							</div>

							<!-- Row 2: HMR broadcast -->
							<div class="node col-3" style="--node-color: var(--ws)">
								<div class="node-name">ProjectCoordinator</div>
								<div class="node-detail">triggerUpdate()</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--ws)">
								<span class="h-arrow-label">HmrUpdateMessage</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--text)">
								<div class="node-name">Preview</div>
								<div class="node-detail">update / reload</div>
							</div>
						</div>

						<div class="flow-connector">
							<span class="flow-connector-icon">↓</span>
							<span class="flow-connector-text">Reload triggers on-demand asset fetches</span>
						</div>

						<div class="flow-label" style="color: var(--orange)">On-Demand Fetch Path</div>
						<div class="flow-grid">
							<!-- Row 1: Request & Read -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Preview</div>
								<div class="node-detail">GET /src/main.ts</div>
							</div>
							<div class="h-arrow col-2" style="--arrow-color: var(--orange)">
								<span class="h-arrow-label">HTTP request</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--orange)">
								<div class="node-name">Host Worker</div>
								<div class="node-detail">serveFile()</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--magenta)">
								<span class="h-arrow-label">fs.readFile()</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--magenta)">
								<div class="node-name">DO Filesystem</div>
								<div class="node-detail">read source</div>
							</div>

							<!-- Connector: Host transforms -->
							<div class="v-connector col-3" style="--arrow-color: var(--yellow)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">transformModule()</span>
							</div>

							<!-- Row 2: Transform -->
							<div class="node col-3" style="--node-color: var(--yellow)">
								<div class="node-name">esbuild-wasm</div>
								<div class="node-detail">TS→JS transform</div>
							</div>

							<!-- Connector: Return response -->
							<div class="v-connector col-3" style="--arrow-color: var(--asset)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">returns JS</span>
							</div>

							<!-- Row 3: Response -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Preview</div>
								<div class="node-detail">receives JS</div>
							</div>
							<div class="h-arrow reverse col-2" style="--arrow-color: var(--asset)">
								<span class="h-arrow-label">200 OK</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--orange)">
								<div class="node-name">Host Worker</div>
								<div class="node-detail">proxies response</div>
							</div>
						</div>
					</div>

					<!--LANE 2: WORKER EXECUTION-->
					<div class="lane">
						<div class="lane-header">
							<span class="lane-dot" style="background: var(--worker)"></span>
							<span class="lane-title" style="color: var(--worker)">Worker Execution</span>
							<span class="lane-desc">API request → read &amp; bundle worker/ → spawn V8 isolate → return response</span>
						</div>

						<div class="flow-grid">
							<!-- Row 1: Request & Read -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Preview</div>
								<div class="node-detail">fetch('/api/items')</div>
							</div>
							<div class="h-arrow col-2" style="--arrow-color: var(--worker)">
								<span class="h-arrow-label">/preview/api/*</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--orange)">
								<div class="node-name">Host Worker</div>
								<div class="node-detail">handlePreviewAPI()</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--magenta)">
								<span class="h-arrow-label">collectFiles()</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--magenta)">
								<div class="node-name">DO Filesystem</div>
								<div class="node-detail">read worker/ files</div>
							</div>

							<!-- Connector: Host bundles code -->
							<div class="v-connector col-3" style="--arrow-color: var(--yellow)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">bundles code</span>
							</div>

							<!-- Row 2: Bundle -->
							<div class="node col-3" style="--node-color: var(--yellow)">
								<div class="node-name">esbuild-wasm</div>
								<div class="node-detail">transformCode()</div>
							</div>

							<!-- Connector: Run in isolate -->
							<div class="v-connector col-3" style="--arrow-color: var(--worker)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">runs in isolate</span>
							</div>

							<!-- Row 3: Load & Respond -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Preview</div>
								<div class="node-detail">receives JSON</div>
							</div>
							<div class="h-arrow reverse col-2" style="--arrow-color: var(--worker)">
								<span class="h-arrow-label">200 OK</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--worker)">
								<div class="node-name">Worker Loader</div>
								<div class="node-detail">dynamic V8 isolate</div>
							</div>
						</div>

						<p class="lane-note">Editor UI writes worker/ files to DO Filesystem via Host Worker (same as Asset Pipeline save path).</p>
					</div>

					<!-- LANE 3: WEBSOCKET FEEDBACK -->
					<div class="lane">
						<div class="lane-header">
							<span class="lane-dot" style="background: var(--ws)"></span>
							<span class="lane-title" style="color: var(--ws)">WebSocket Feedback</span>
							<span class="lane-desc">Logs &amp; errors flow from Sources (Left) → Coordinator (Right) → Editor (Bottom)</span>
						</div>

						<div class="flow-grid">
							<!-- Row 1: Logs Path -->
							<div class="node col-1" style="grid-row: 1; --node-color: var(--worker)">
								<div class="node-name">Worker Loader</div>
								<div class="node-detail">console.log()</div>
							</div>
							<div class="h-arrow col-2" style="grid-row: 1; --arrow-color: var(--ws)">
								<span class="h-arrow-label">tail binding</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="grid-row: 1; --node-color: var(--ws)">
								<div class="node-name">LogTailer</div>
								<div class="node-detail">tail() handler</div>
							</div>
							<div class="h-arrow col-4" style="grid-row: 1; --arrow-color: var(--ws)">
								<span class="h-arrow-label">ServerLogsMessage</span>
								<div class="h-arrow-line"></div>
							</div>

							<!-- Row 2: Error Path (Host in Col 1) -->
							<div class="node col-1" style="grid-row: 2; margin-top: 12px; --node-color: var(--orange)">
								<div class="node-name">Host Worker</div>
								<div class="node-detail">catch error</div>
							</div>
							<!-- Long arrow spanning Col 2-4 -->
							<div class="h-arrow col-span-3" style="grid-row: 2; margin-top: 12px; --arrow-color: var(--red)">
								<span class="h-arrow-label">ServerErrorMessage</span>
								<div class="h-arrow-line"></div>
							</div>

							<!-- Aggregator: ProjectCoordinator (Spans Rows 1-2) -->
							<div
								class="node col-5"
								style="
									grid-row: 1 / span 2;
									align-self: center;
									height: 100%;
									display: flex;
									flex-direction: column;
									justify-content: center;
									--node-color: var(--ws);
									z-index: 2;
								"
							>
								<div class="node-name">ProjectCoordinator</div>
								<div class="node-detail">sendToAll()</div>
							</div>

							<!-- Connector: Broadcast -->
							<div class="v-connector col-5" style="grid-row: 3; --arrow-color: var(--ws)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">WS broadcast</span>
							</div>

							<!-- Destination: Editor UI -->
							<div class="node col-5" style="grid-row: 4; --node-color: var(--text)">
								<div class="node-name">Editor UI</div>
								<div class="node-detail">console / overlay</div>
							</div>
						</div>
					</div>

					<!-- LANE 4: DEPENDENCY RESOLUTION -->
					<div class="lane">
						<div class="lane-header">
							<span class="lane-dot" style="background: var(--cyan)"></span>
							<span class="lane-title" style="color: var(--cyan)">Dependency Resolution</span>
							<span class="lane-desc">Bare imports resolved via esm.sh CDN at bundle time</span>
						</div>

						<div class="flow-label" style="color: var(--cyan)">Import Resolution Flow</div>
						<div class="flow-grid">
							<!-- Row 1: Source import -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Source Code</div>
								<div class="node-detail">import "react"</div>
							</div>
							<div class="h-arrow col-2" style="--arrow-color: var(--yellow)">
								<span class="h-arrow-label">onResolve</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--yellow)">
								<div class="node-name">VirtualFsPlugin</div>
								<div class="node-detail">bare import check</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--magenta)">
								<span class="h-arrow-label">lookup version</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--magenta)">
								<div class="node-name">.project-meta.json</div>
								<div class="node-detail">dependencies map</div>
							</div>

							<!-- Connector: Rewrite to CDN -->
							<div class="v-connector col-3" style="--arrow-color: var(--cyan)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">rewrite to CDN URL</span>
							</div>

							<!-- Row 2: CDN fetch -->
							<div class="node col-1" style="--node-color: var(--yellow)">
								<div class="node-name">esbuild-wasm</div>
								<div class="node-detail">bundleWithCdn()</div>
							</div>
							<div class="h-arrow reverse col-2" style="--arrow-color: var(--cyan)">
								<span class="h-arrow-label">bundled JS</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--cyan)">
								<div class="node-name">EsmCdnPlugin</div>
								<div class="node-detail">onLoad handler</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--cyan)">
								<span class="h-arrow-label">fetch + cache</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--cyan)">
								<div class="node-name">esm.sh CDN</div>
								<div class="node-detail">react@19.0.0</div>
							</div>
						</div>

						<p class="lane-note">
							Dependencies are managed via <code>.project-meta.json</code> instead of package.json. Unregistered imports trigger an error
							prompting users to add the dependency via the Dependencies panel.
						</p>
					</div>

					<!-- LANE 5: GIT INTEGRATION -->
					<div class="lane">
						<div class="lane-header">
							<span class="lane-dot" style="background: var(--emerald)"></span>
							<span class="lane-title" style="color: var(--emerald)">Git Integration</span>
							<span class="lane-desc">isomorphic-git running inside Durable Object with SQLite storage</span>
						</div>

						<div class="flow-label" style="color: var(--emerald)">Git Operations Flow</div>
						<div class="flow-grid">
							<!-- Row 1: UI to API -->
							<div class="node col-1" style="--node-color: var(--text)">
								<div class="node-name">Git Panel</div>
								<div class="node-detail">stage / commit</div>
							</div>
							<div class="h-arrow col-2" style="--arrow-color: var(--emerald)">
								<span class="h-arrow-label">POST /api/git/*</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--orange)">
								<div class="node-name">Host Worker</div>
								<div class="node-detail">git-routes.ts</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--magenta)">
								<span class="h-arrow-label">RPC call</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--magenta)">
								<div class="node-name">ExpiringFilesystem</div>
								<div class="node-detail">Durable Object</div>
							</div>

							<!-- Connector: Mount context -->
							<div class="v-connector col-5" style="--arrow-color: var(--emerald)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">withGitMount()</span>
							</div>

							<!-- Row 2: Git service -->
							<div class="node col-3" style="--node-color: var(--emerald)">
								<div class="node-name">GitService</div>
								<div class="node-detail">isomorphic-git wrapper</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--emerald)">
								<span class="h-arrow-label">git operations</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--emerald)">
								<div class="node-name">isomorphic-git</div>
								<div class="node-detail">stage / commit / etc</div>
							</div>

							<!-- Connector: Filesystem access -->
							<div class="v-connector col-5" style="--arrow-color: var(--magenta)">
								<div class="v-connector-line"></div>
								<span class="v-connector-label">node:fs/promises</span>
							</div>

							<!-- Row 3: SQLite storage -->
							<div class="node col-5" style="--node-color: var(--magenta)">
								<div class="node-name">worker-fs-mount</div>
								<div class="node-detail">DO SQLite storage</div>
							</div>
						</div>

						<div class="flow-connector">
							<span class="flow-connector-icon">↓</span>
							<span class="flow-connector-text">After mutations, status changes are broadcast via WebSocket</span>
						</div>

						<div class="flow-label" style="color: var(--ws)">Real-time Status Updates</div>
						<div class="flow-grid">
							<div class="node col-1" style="--node-color: var(--magenta)">
								<div class="node-name">ExpiringFilesystem</div>
								<div class="node-detail">broadcastGitStatusChanged()</div>
							</div>
							<div class="h-arrow col-2" style="--arrow-color: var(--ws)">
								<span class="h-arrow-label">RPC</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-3" style="--node-color: var(--ws)">
								<div class="node-name">ProjectCoordinator</div>
								<div class="node-detail">sendMessage()</div>
							</div>
							<div class="h-arrow col-4" style="--arrow-color: var(--ws)">
								<span class="h-arrow-label">git-status-changed</span>
								<div class="h-arrow-line"></div>
							</div>
							<div class="node col-5" style="--node-color: var(--text)">
								<div class="node-name">Git Panel</div>
								<div class="node-detail">refetch status</div>
							</div>
						</div>

						<p class="lane-note">
							Git operations run inside the Durable Object's single-threaded context, avoiding race conditions with isomorphic-git's
							AsyncLock. The <code>node:fs/promises</code> import is aliased to <code>worker-fs-mount/fs</code> at build time.
						</p>
					</div>
				</div>
			</section>
		</div>
	</body>
</html>
